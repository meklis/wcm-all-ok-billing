# Модуль интеграции с биллиноговой системой AllOkBilling

## Возможности   
- Синхронизация оборудования и доступа к ним   
- Синхронизация списка пользоватей и групп 
- Авторизация с помощью биллинга

## Установка синхронизаци
1. Установить модуль в директорию modules 

2. Внести параметры в .env для подключения к базе
``` 
ALL_OK_BILLING_DATABASE_URL=mysql:host=127.0.0.1;dbname=service;charset=utf8
ALL_OK_BILLING_DATABASE_USER=root
ALL_OK_BILLING_DATABASE_PASSWD=
ALL_OK_BILLING_API_URL=https://API-address 
```
3. Выполнить миграции командой 
``` 
wca migration:migrate all_ok_billing:* --up
```
4. Добавить в крон команды, выполняющие синхронизацию
``` 
#Синхронизация устройств и доступов к оборудованию 
*/5   *   *   *   *  wca all_ok_billing:sync-devices

#Синхронизация пользователей (необходимо, если используется авторизация через биллинг)
*/5   *   *   *   *  wca all_ok_billing:sync-users
```

5. Что бы включить авторизацию через биллинг - необходимо изменить способ прохождения авторизации.  
Для этого в файле .env необходимо заменить значение AUTH_CHECK_PAIR_METHOD
```
AUTH_CHECK_PAIR_METHOD=\WCM\AllOkBilling\UserAuthAction
```

### Внимание!
Группа с именем "Администратор" имеет все права, другие группы не будут иметь прав.    
После включения синхронизации необходимо зайти в систему и проставить права группам с биллинга.    
После изменения AUTH_CHECK_PAIR_METHOD авторизоваться с доступами WildCore будет невозможно. 



Если в биллинге будет присутствовать пользователь с логином таким же как в wildcore - он будет перезаписан и возможно, доступ к системе будет утерян.    
Системные логины:     
- admin
- rpc 
- cron
- console
- sys

Так же сравнение оборудования происходит по IP. В случае дубликатов IP - синхронизация перезапишет устройство из биллинга.  